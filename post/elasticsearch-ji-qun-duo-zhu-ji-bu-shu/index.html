<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Elasticsearch 8.0.0 é›†ç¾¤éƒ¨ç½²æ–‡æ¡£ | OrochW&#39;s Blog</title>
<link rel="shortcut icon" href="https://orochw.github.io/favicon.ico?v=1757257179686">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://orochw.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Elasticsearch 8.0.0 é›†ç¾¤éƒ¨ç½²æ–‡æ¡£ | OrochW&#39;s Blog - Atom Feed" href="https://orochw.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133741629-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-133741629-1');
</script>


    <meta name="description" content="ğŸ“š Elasticsearch 8.0.0 ä¸‰èŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æ–‡æ¡£

ç‰ˆæœ¬ï¼šv1.1
ç¼–å†™æ—¥æœŸï¼š2025å¹´9æœˆ7æ—¥
ç›®æ ‡ï¼šæ­å»ºé«˜å¯ç”¨ ES é›†ç¾¤ï¼ˆ3èŠ‚ç‚¹ï¼‰
éƒ¨ç½²æ–¹å¼ï¼šTarball + è‡ªå®šä¹‰è„šæœ¬ç®¡ç†
ç¯å¢ƒï¼šLinuxï¼ˆUbuntu/Cent..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://orochw.github.io">
  <img class="avatar" src="https://orochw.github.io/images/avatar.png?v=1757257179686" alt="">
  </a>
  <h1 class="site-title">
    OrochW&#39;s Blog
  </h1>
  <p class="site-description">
    
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/OrochW" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Elasticsearch 8.0.0 é›†ç¾¤éƒ¨ç½²æ–‡æ¡£
            </h2>
            <div class="post-info">
              <span>
                2023-01-05
              </span>
              <span>
                14 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h1 id="elasticsearch-800-ä¸‰èŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æ–‡æ¡£">ğŸ“š Elasticsearch 8.0.0 ä¸‰èŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æ–‡æ¡£</h1>
<blockquote>
<p><strong>ç‰ˆæœ¬</strong>ï¼šv1.1<br>
<strong>ç¼–å†™æ—¥æœŸ</strong>ï¼š2025å¹´9æœˆ7æ—¥<br>
<strong>ç›®æ ‡</strong>ï¼šæ­å»ºé«˜å¯ç”¨ ES é›†ç¾¤ï¼ˆ3èŠ‚ç‚¹ï¼‰<br>
<strong>éƒ¨ç½²æ–¹å¼</strong>ï¼šTarball + è‡ªå®šä¹‰è„šæœ¬ç®¡ç†<br>
<strong>ç¯å¢ƒ</strong>ï¼šLinuxï¼ˆUbuntu/CentOS ç±»ï¼‰</p>
</blockquote>
<hr>
<h2 id="ä¸€-æ“ä½œç›®æ ‡">ä¸€ã€æ“ä½œç›®æ ‡</h2>
<ul>
<li>éƒ¨ç½² 3 ä¸ª Elasticsearch 8.0.0 èŠ‚ç‚¹ï¼Œç»„æˆé«˜å¯ç”¨é›†ç¾¤</li>
<li>å®ç°èŠ‚ç‚¹é—´è‡ªåŠ¨å‘ç°ã€ä¸»èŠ‚ç‚¹é€‰ä¸¾ã€æ•°æ®åˆ†ç‰‡åˆ†é…</li>
<li>æä¾›ç»Ÿä¸€çš„å¯åœè„šæœ¬ï¼Œä¾¿äºè¿ç»´ç®¡ç†</li>
<li>éªŒè¯é›†ç¾¤å¥åº·çŠ¶æ€</li>
</ul>
<hr>
<h2 id="äºŒ-æ“ä½œç¯å¢ƒ">äºŒã€æ“ä½œç¯å¢ƒ</h2>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹</th>
<th>ä¸»æœºå</th>
<th>IP åœ°å€</th>
<th>è§’è‰²</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>121-es1</code></td>
<td><code>172.31.7.121</code></td>
<td>master/data/ingest</td>
</tr>
<tr>
<td>2</td>
<td><code>122-es2</code></td>
<td><code>172.31.7.122</code></td>
<td>master/data/ingest</td>
</tr>
<tr>
<td>3</td>
<td><code>123-es3</code></td>
<td><code>172.31.7.123</code></td>
<td>master/data/ingest</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ‰€æœ‰èŠ‚ç‚¹é…ç½®ç›¸åŒï¼Œå‡ä¸º master-eligibleã€‚</p>
</blockquote>
<hr>
<h2 id="ä¸‰-æ“ä½œæ­¥éª¤-ä½ æ‰§è¡Œçš„åŠ¨ä½œ">ä¸‰ã€æ“ä½œæ­¥éª¤ï¼ˆâœ… ä½ æ‰§è¡Œçš„åŠ¨ä½œï¼‰</h2>
<h3 id="1-åˆ†å‘è½¯ä»¶åŒ…æ‰€æœ‰èŠ‚ç‚¹">1. åˆ†å‘è½¯ä»¶åŒ…ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3>
<pre><code class="language-bash"># åœ¨ 121 ä¸Šæ‰§è¡Œ
scp elasticsearch-8.0.0-linux-x86_64.tar.gz 172.31.7.122:/apps
scp elasticsearch-8.0.0-linux-x86_64.tar.gz 172.31.7.123:/apps
</code></pre>
<hr>
<h3 id="2-å®‰è£…ä¸ç›®å½•å‡†å¤‡æ‰€æœ‰èŠ‚ç‚¹">2. å®‰è£…ä¸ç›®å½•å‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3>
<pre><code class="language-bash">cd /apps
tar xf elasticsearch-8.0.0-linux-x86_64.tar.gz
ln -sv elasticsearch-8.0.0 elasticsearch
</code></pre>
<hr>
<h3 id="3-åˆ›å»ºä¸“ç”¨ç”¨æˆ·æ‰€æœ‰èŠ‚ç‚¹">3. åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3>
<pre><code class="language-bash">groupadd es
useradd es -g es
</code></pre>
<hr>
<h3 id="4-åˆ›å»ºæ•°æ®ä¸æ—¥å¿—ç›®å½•æ‰€æœ‰èŠ‚ç‚¹">4. åˆ›å»ºæ•°æ®ä¸æ—¥å¿—ç›®å½•ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3>
<pre><code class="language-bash">mkdir -p /data/elasticsearch/data
mkdir -p /data/elasticsearch/logs
chown -R es:es /apps/elasticsearch
chown -R es:es /data/elasticsearch
</code></pre>
<hr>
<h3 id="5-é…ç½®-elasticsearchymlæ‰€æœ‰èŠ‚ç‚¹">5. é…ç½® <code>elasticsearch.yml</code>ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3>
<pre><code class="language-bash">vim /apps/elasticsearch/config/elasticsearch.yml
</code></pre>
<h4 id="é…ç½®å†…å®¹ç¤ºä¾‹121-es1">é…ç½®å†…å®¹ï¼ˆç¤ºä¾‹ï¼š<code>121-es1</code>ï¼‰</h4>
<pre><code class="language-yaml"># =================================== é›†ç¾¤é…ç½® ===================================
# é›†ç¾¤åç§°ï¼ˆæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä¸€è‡´ï¼‰
# åŒä¸€ä¸ªç½‘ç»œå†…ï¼Œç›¸åŒ cluster.name çš„èŠ‚ç‚¹ä¼šè‡ªåŠ¨ç»„æˆé›†ç¾¤
cluster.name: elasticsearch


# èŠ‚ç‚¹åç§°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»å”¯ä¸€ï¼ï¼‰
# â— åœ¨ node-1ã€node-2ã€node-3 ä¸Šåˆ†åˆ«è®¾ç½®ä¸ºï¼š
#    node-1: node.name: node-1
#    node-2: node.name: node-2
#    node-3: node.name: node-3
node.name: node-1


# èŠ‚ç‚¹è§’è‰²å®šä¹‰ï¼ˆé»˜è®¤å·²å¯ç”¨ master/data/ingestï¼‰
# å¯é€‰å€¼ï¼šmaster, data, ingest, remote_cluster_client, ml, voting_only ç­‰
# å½“å‰ä¸ºé€šç”¨èŠ‚ç‚¹ï¼Œæ‰¿æ‹…ä¸»èŠ‚ç‚¹é€‰ä¸¾ã€æ•°æ®å­˜å‚¨ã€æ•°æ®é¢„å¤„ç†
node.roles: [master, data, ingest]


# =================================== ç½‘ç»œé…ç½® ===================================
# ç»‘å®šçš„ç½‘ç»œæ¥å£ï¼Œ0.0.0.0 è¡¨ç¤ºç›‘å¬æ‰€æœ‰ç½‘å¡
network.host: 0.0.0.0

# HTTP æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤ 9200ï¼‰ï¼Œç”¨äº REST API
http.port: 9200

# Transport ç«¯å£ï¼ˆé»˜è®¤ 9300ï¼‰ï¼Œç”¨äºèŠ‚ç‚¹é—´é€šä¿¡
transport.port: 9300


# =================================== å‘ç°ä¸é›†ç¾¤å½¢æˆ ===================================
# åˆå§‹ä¸»èŠ‚ç‚¹å€™é€‰åˆ—è¡¨ï¼ˆä»…åœ¨é›†ç¾¤é¦–æ¬¡å¯åŠ¨æ—¶ç”Ÿæ•ˆï¼ï¼‰
# â— é¦–æ¬¡å¯åŠ¨åå¿…é¡»æ³¨é‡Šæˆ–åˆ é™¤æ­¤è¡Œï¼Œå¦åˆ™é‡å¯å¯èƒ½å‡ºé”™
# â— æ‰€æœ‰ master-eligible èŠ‚ç‚¹çš„ node.name å¿…é¡»åœ¨æ­¤åˆ—è¡¨ä¸­
cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;, &quot;node-3&quot;]

# é›†ç¾¤ç§å­ä¸»æœºåˆ—è¡¨ï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€é…ç½®ï¼‰
# æ ¼å¼ï¼š[&quot;ip:port&quot;, &quot;ip:port&quot;, ...]
# ç”¨äºèŠ‚ç‚¹å‘ç°å’Œé›†ç¾¤ç»„å»º
# â— æ‰€æœ‰ master-eligible èŠ‚ç‚¹çš„ IP:9300 éƒ½åº”åœ¨æ­¤åˆ—å‡º
discovery.seed_hosts: 
  - &quot;172.31.7.121:9300&quot;
  - &quot;172.31.7.122:9300&quot;
  - &quot;172.31.7.123:9300&quot;


# =================================== æ•°æ®ä¸æ—¥å¿—è·¯å¾„ ===================================
# æ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆå»ºè®®ç‹¬ç«‹ç£ç›˜ï¼‰
path.data: /data/elasticsearch/data

# æ—¥å¿—å­˜å‚¨è·¯å¾„
path.logs: /data/elasticsearch/logs


# =================================== å®‰å…¨é…ç½®ï¼ˆæµ‹è¯•ç¯å¢ƒå…³é—­ï¼‰ ===================================
# âŒ æµ‹è¯•ç¯å¢ƒå…³é—­å®‰å…¨åŠŸèƒ½ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»å¼€å¯ï¼‰
xpack.security.enabled: false

# âŒ å…³é—­ HTTPS å’Œä¼ è¾“å±‚ SSL åŠ å¯†ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»å¼€å¯ï¼‰
xpack.security.http.ssl.enabled: false
xpack.security.transport.ssl.enabled: false

# âŒ å…³é—­ç›‘æ§æ•°æ®æ”¶é›†ï¼ˆå¯é€‰ï¼‰
xpack.monitoring.collection.enabled: false


# =================================== JVM ä¸æ€§èƒ½è°ƒä¼˜ï¼ˆå¯é€‰ï¼‰ ===================================
# å †å†…å­˜å¤§å°ï¼ˆå»ºè®®ä¸è¶…è¿‡ç‰©ç†å†…å­˜ 50%ï¼Œä¸”ä¸è¶…è¿‡ 32GBï¼‰
# ä¿®æ”¹ä½ç½®ï¼šconfig/jvm.options
# ç¤ºä¾‹ï¼š-Xms4g
#       -Xmx4g

# æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼ˆéœ€ç³»ç»Ÿé…ç½®ï¼‰
# ç¡®ä¿ç³»ç»Ÿ ulimit -n &gt;= 65536

# æœ€å¤§æ˜ å°„æ•°é‡ï¼ˆå¿…é¡»è®¾ç½®ï¼‰
# sysctl -w vm.max_map_count=262144
</code></pre>
<blockquote>
<p>ğŸ” æ³¨æ„ï¼š</p>
<ul>
<li><code>node.name</code> æ¯å°æœºå™¨å”¯ä¸€ï¼ˆ<code>node-1</code>, <code>node-2</code>, <code>node-3</code>ï¼‰</li>
<li><code>cluster.initial_master_nodes</code> ä»…åœ¨é¦–æ¬¡å¯åŠ¨æ—¶é…ç½®</li>
</ul>
</blockquote>
<hr>
<h3 id="6-è°ƒæ•´ç³»ç»Ÿå‚æ•°æ‰€æœ‰èŠ‚ç‚¹">6. è°ƒæ•´ç³»ç»Ÿå‚æ•°ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3>
<pre><code class="language-bash">echo &quot;vm.max_map_count=262144&quot; &gt;&gt; /etc/sysctl.conf
sysctl -p
</code></pre>
<hr>
<h2 id="å››-ä¸ºä»€ä¹ˆè¦å†™å¯åŠ¨è„šæœ¬">å››ã€ä¸ºä»€ä¹ˆè¦å†™å¯åŠ¨è„šæœ¬ï¼Ÿ</h2>
<h3 id="é—®é¢˜">â“ é—®é¢˜</h3>
<ul>
<li>Elasticsearch ä»¥ <code>java</code> è¿›ç¨‹è¿è¡Œï¼Œç›´æ¥å¯åŠ¨ä¸æ˜“ç®¡ç†</li>
<li>éœ€è¦ä»¥ <code>es</code> ç”¨æˆ·è¿è¡Œï¼Œä¸èƒ½ç”¨ <code>root</code> å¯åŠ¨</li>
<li>ç¼ºå°‘ <code>start</code> / <code>stop</code> / <code>status</code> ç»Ÿä¸€æ¥å£</li>
<li>æ— æ³•å¿«é€Ÿåˆ¤æ–­è¿›ç¨‹çŠ¶æ€å’Œ API å¯è¾¾æ€§</li>
</ul>
<h3 id="è§£å†³æ–¹æ¡ˆç¼–å†™-start_essh-è„šæœ¬">âœ… è§£å†³æ–¹æ¡ˆï¼šç¼–å†™ <code>start_es.sh</code> è„šæœ¬</h3>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start</code></td>
<td>ä»¥ <code>es</code> ç”¨æˆ·åå°å¯åŠ¨ ES</td>
</tr>
<tr>
<td><code>stop</code></td>
<td>å®‰å…¨åœæ­¢è¿›ç¨‹ï¼Œæ”¯æŒä¼˜é›…å…³é—­</td>
</tr>
<tr>
<td><code>status</code></td>
<td>æ£€æŸ¥è¿›ç¨‹ + API + é›†ç¾¤å¥åº·</td>
</tr>
<tr>
<td><code>restart</code></td>
<td>é‡å¯æœåŠ¡</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="äº”-è„šæœ¬è®¾è®¡æ€è·¯">äº”ã€è„šæœ¬è®¾è®¡æ€è·¯</h2>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>å®ç°æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯åŠ¨</td>
<td><code>su - es -c &quot;nohup ./elasticsearch -d&quot;</code></td>
</tr>
<tr>
<td>åœæ­¢</td>
<td><code>pgrep -f elasticsearch</code> + <code>kill -15</code></td>
</tr>
<tr>
<td>çŠ¶æ€</td>
<td>æ£€æŸ¥è¿›ç¨‹ + <code>curl</code> æµ‹è¯• API + é›†ç¾¤å¥åº·</td>
</tr>
<tr>
<td>ç”¨æˆ·</td>
<td>å›ºå®šä¸º <code>es</code>ï¼Œé¿å…æƒé™é—®é¢˜</td>
</tr>
<tr>
<td>æ—¥å¿—</td>
<td>è¾“å‡ºå½©è‰²ä¿¡æ¯ï¼Œä¾¿äºè¯†åˆ«</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="å…­-å¯åŠ¨è„šæœ¬å†…å®¹rootstart_essh">å…­ã€å¯åŠ¨è„šæœ¬å†…å®¹ï¼ˆ<code>/root/start_es.sh</code>ï¼‰</h2>
<pre><code class="language-bash">#!/bin/bash

# ========================================
# Elasticsearch ç®¡ç†è„šæœ¬
# æ”¯æŒ: start | stop | status
# æ—¥å¿—è·¯å¾„: /data/elasticsearch/logs
# ========================================

# é…ç½®å˜é‡
ES_USER=&quot;es&quot;
ES_HOME=&quot;/apps/elasticsearch&quot;
ES_LOG_DIR=&quot;/data/elasticsearch/logs&quot;
ES_PID_FILE=&quot;/var/run/elasticsearch.pid&quot;  # PID æ–‡ä»¶ä½ç½®
ES_CMD=&quot;cd ${ES_HOME} &amp;&amp; ./bin/elasticsearch -d&quot;

# é¢œè‰²è¾“å‡º
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨ï¼ˆå¯é€‰ï¼‰
ensure_log_dir() {
    if ! su - ${ES_USER} -c &quot;test -d ${ES_LOG_DIR}&quot;; then
        echo -e &quot;${YELLOW}è­¦å‘Š: æ—¥å¿—ç›®å½• ${ES_LOG_DIR} ä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º...${NC}&quot;
        mkdir -p ${ES_LOG_DIR}
        chown ${ES_USER}:${ES_USER} ${ES_LOG_DIR}
        chmod 755 ${ES_USER} ${ES_LOG_DIR}
    fi
}

# æ£€æŸ¥ es ç”¨æˆ·å®¶ç›®å½•
ensure_home_dir() {
    if [ ! -d &quot;/home/es&quot; ]; then
        echo &quot;åˆ›å»º es ç”¨æˆ·å®¶ç›®å½• /home/es&quot;
        mkdir -p /home/es
        chown ${ES_USER}:${ES_USER} /home/es
        chmod 755 /home/es
    fi
}

# å¯åŠ¨ Elasticsearch
start() {
    ensure_home_dir
    ensure_log_dir

    if pgrep -u ${ES_USER} elasticsearch &gt; /dev/null; then
        echo -e &quot;${YELLOW}Elasticsearch å·²åœ¨è¿è¡Œã€‚${NC}&quot;
        status
        exit 1
    fi

    echo &quot;æ­£åœ¨ä»¥ç”¨æˆ· ${ES_USER} å¯åŠ¨ Elasticsearch...&quot;
    if su - ${ES_USER} -c &quot;${ES_CMD}&quot;; then
        # ç­‰å¾… PID æ–‡ä»¶æˆ–è¿›ç¨‹ç¨³å®š
        sleep 3
        local pid=$(pgrep -u ${ES_USER} elasticsearch)
        if [ -n &quot;$pid&quot; ]; then
            echo $pid &gt; ${ES_PID_FILE}
            chown ${ES_USER}:${ES_USER} ${ES_PID_FILE} 2&gt;/dev/null || true
            echo -e &quot;${GREEN}âœ… Elasticsearch å·²æˆåŠŸå¯åŠ¨ï¼ŒPID: ${pid}${NC}&quot;
        else
            echo -e &quot;${RED}âŒ å¯åŠ¨æˆåŠŸä½†æ— æ³•è·å– PIDï¼Œè¯·æ£€æŸ¥æ—¥å¿—ã€‚${NC}&quot;
        fi
    else
        echo -e &quot;${RED}âŒ å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—: ${ES_LOG_DIR}${NC}&quot;
        exit 1
    fi
}

# åœæ­¢ Elasticsearch
stop() {
    # ä½¿ç”¨ -f åŒ¹é…å‘½ä»¤è¡Œä¸­çš„ elasticsearch
    local pids=($(pgrep -u ${ES_USER} -f elasticsearch))

    if [ ${#pids[@]} -eq 0 ]; then
        echo -e &quot;${YELLOW}Elasticsearch æœªè¿è¡Œã€‚${NC}&quot;
        return 0
    fi

    echo -e &quot;${YELLOW}å‘ç° ${#pids[@]} ä¸ª Elasticsearch è¿›ç¨‹ï¼š${pids[*]}${NC}&quot;

    # å°è¯•ä¼˜é›…åœæ­¢
    for pid in &quot;${pids[@]}&quot;; do
        echo &quot;æ­£åœ¨åœæ­¢ PID: $pid&quot;
        kill -15 $pid
    done

    # ç­‰å¾…æœ€å¤š 30 ç§’
    for i in {1..30}; do
        local running=0
        for pid in &quot;${pids[@]}&quot;; do
            if kill -0 $pid 2&gt;/dev/null; then
                running=1
            fi
        done
        if [ $running -eq 0 ]; then
            echo -e &quot;${GREEN}âœ… æ‰€æœ‰ Elasticsearch è¿›ç¨‹å·²åœæ­¢ã€‚${NC}&quot;
            rm -f ${ES_PID_FILE}
            return 0
        fi
        sleep 1
    done

    # è¶…æ—¶ï¼Œå¼ºåˆ¶ç»ˆæ­¢
    echo -e &quot;${RED}è¶…æ—¶ï¼Œæ­£åœ¨å¼ºåˆ¶ç»ˆæ­¢...${NC}&quot;
    for pid in &quot;${pids[@]}&quot;; do
        if kill -0 $pid 2&gt;/dev/null; then
            kill -9 $pid
            echo &quot;å·²å¼ºåˆ¶ç»ˆæ­¢ PID: $pid&quot;
        fi
    done
    rm -f ${ES_PID_FILE}
    echo -e &quot;${GREEN}âœ… å¼ºåˆ¶åœæ­¢å®Œæˆã€‚${NC}&quot;
}
# æŸ¥çœ‹çŠ¶æ€ï¼šæœ¬åœ°è¿›ç¨‹ + é›†ç¾¤å¥åº·
status() {
    echo -e &quot;${YELLOW}ğŸ” æ­£åœ¨æ£€æŸ¥ Elasticsearch çŠ¶æ€...${NC}&quot;

    # ä½¿ç”¨ pgrep -f åŒ¹é…å‘½ä»¤è¡Œï¼Œæ”¯æŒ java -cp ... elasticsearch
    local pids=($(pgrep -u ${ES_USER} -f elasticsearch 2&gt;/dev/null))

    # æ£€æŸ¥æ˜¯å¦æœ‰è¿è¡Œä¸­çš„è¿›ç¨‹
    if [ ${#pids[@]} -gt 0 ]; then
        local main_pid=${pids[0]}
        if [ ${#pids[@]} -eq 1 ]; then
            echo -e &quot;${GREEN}ğŸŸ¢ Elasticsearch æ­£åœ¨è¿è¡Œ${NC}&quot;
            echo -e &quot;   PID: ${main_pid}&quot;
        else
            echo -e &quot;${YELLOW}ğŸŸ¡ æ£€æµ‹åˆ°å¤šä¸ª Elasticsearch è¿›ç¨‹ï¼ˆå¯èƒ½å­˜åœ¨æ®‹ç•™ï¼‰${NC}&quot;
            printf &quot;   PID åˆ—è¡¨: &quot;
            printf '%s ' &quot;${pids[@]}&quot;
            echo
            echo -e &quot;   ä¸» PID: ${main_pid}&quot;
        fi

        # æ£€æŸ¥ REST API æ˜¯å¦å“åº”
        local http_url=&quot;http://localhost:9200&quot;
        echo -e &quot;\n${YELLOW}ğŸ“¡ æ­£åœ¨è¿æ¥ REST API: ${http_url}${NC}&quot;

        if ! command -v curl &amp;&gt; /dev/null; then
            echo -e &quot;${RED}âŒ é”™è¯¯: curl æœªå®‰è£…ï¼Œæ— æ³•æ£€æŸ¥ API çŠ¶æ€${NC}&quot;
            return 1
        fi

        # å°è¯•è·å–æ ¹ç«¯ç‚¹
        if curl -s --connect-timeout 5 --max-time 10 &quot;${http_url}&quot; &gt; /dev/null; then
            echo -e &quot;${GREEN}âœ… REST API å¯è®¿é—®${NC}&quot;

            # å°è¯•è·å–é›†ç¾¤å¥åº·çŠ¶æ€
            echo -e &quot;\n${YELLOW}ğŸ“Š é›†ç¾¤å¥åº·çŠ¶æ€:${NC}&quot;
            local health_output=$(curl -s -X GET &quot;${http_url}/_cluster/health?pretty&quot; 2&gt;/dev/null)
            local status_code=$(echo &quot;$health_output&quot; | grep -o '&quot;status&quot; *: *&quot;[^&quot;]*&quot;' | head -1 | cut -d '&quot;' -f4)

            if [ -n &quot;$status_code&quot; ]; then
                echo &quot;$health_output&quot; | sed 's/^/  | /'
            else
                local error_reason=$(echo &quot;$health_output&quot; | grep -o '&quot;reason&quot; *: *[^,}]*' | head -1 | cut -d ':' -f2- | xargs || echo &quot;unknown&quot;)
                echo &quot;  | âŒ é›†ç¾¤çŠ¶æ€å¼‚å¸¸: $error_reason&quot;
                echo &quot;  |    å»ºè®®: æ£€æŸ¥ elasticsearch.yml ä¸­çš„ discovery é…ç½®&quot;
                echo &quot;  |    å¸¸è§ä¿®å¤: æ·»åŠ  discovery.type: single-nodeï¼ˆå•èŠ‚ç‚¹æ¨¡å¼ï¼‰&quot;
            fi

            # è·å–èŠ‚ç‚¹åˆ—è¡¨
            echo -e &quot;\n${YELLOW}ğŸ” é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯:${NC}&quot;
            local nodes_output=$(curl -s -X GET &quot;${http_url}/_cat/nodes?v&quot; 2&gt;/dev/null)
            if echo &quot;$nodes_output&quot; | grep -q &quot;master_not_discovered_exception&quot;; then
                echo &quot;  | âŒ æ— æ³•è·å–èŠ‚ç‚¹ä¿¡æ¯: master_not_discovered_exception&quot;
            else
                echo &quot;$nodes_output&quot; | sed 's/^/  | /'
            fi

        else
            echo -e &quot;${RED}âŒ REST API æ— æ³•è®¿é—®ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦å®Œå…¨å¯åŠ¨${NC}&quot;
            echo -e &quot;${YELLOW}ğŸ’¡ æç¤º: å¯èƒ½æ­£åœ¨å¯åŠ¨ä¸­ï¼Œæˆ–é…ç½®äº†å®‰å…¨è®¤è¯${NC}&quot;
        fi

        # æ˜¾ç¤ºæ—¥å¿—å°¾éƒ¨
        if [ -d &quot;${ES_LOG_DIR}&quot; ] &amp;&amp; [ -n &quot;$(ls ${ES_LOG_DIR}/*.log 2&gt;/dev/null)&quot; ]; then
            local log_file=$(ls ${ES_LOG_DIR}/*.log | head -n1)
            echo -e &quot;\n${YELLOW}ğŸ“„ æœ€è¿‘æ—¥å¿— (${log_file}):${NC}&quot;
            tail -n 5 &quot;${log_file}&quot; | sed 's/^/  | /'
        else
            echo -e &quot;\n${YELLOW}ğŸ“„ æ—¥å¿—ç›®å½•: ${ES_LOG_DIR} ä¸å­˜åœ¨æˆ–æ— æ—¥å¿—æ–‡ä»¶${NC}&quot;
        fi

    else
        # æ²¡æœ‰æ‰¾åˆ°è¿›ç¨‹
        if [ -f &quot;${ES_PID_FILE}&quot; ]; then
            local old_pid=$(cat &quot;${ES_PID_FILE}&quot;)
            echo -e &quot;${RED}âŒ Elasticsearch æœªè¿è¡Œï¼Œä½†å­˜åœ¨ PID æ–‡ä»¶: ${old_pid}${NC}&quot;
            echo -e &quot;${YELLOW}ğŸ’¡ è¯·æ£€æŸ¥æ˜¯å¦æ®‹ç•™æˆ–æ‰‹åŠ¨ kill è¿›ç¨‹${NC}&quot;
        else
            echo -e &quot;${YELLOW}âšª Elasticsearch æœªè¿è¡Œ${NC}&quot;
        fi
    fi
}
# ä¸»é€»è¾‘
case &quot;$1&quot; in
    start)
        start
        ;;
    stop)
        stop
        ;;
    status)
        status
        ;;
    restart)
        stop
        sleep 2
        start
        ;;
    *)
        echo &quot;ç”¨æ³•: $0 {start|stop|status|restart}&quot;
        exit 1
        ;;
esac

exit 0

</code></pre>
<h3 id="èµ‹äºˆæƒé™">èµ‹äºˆæƒé™ï¼š</h3>
<pre><code class="language-bash">chmod +x /root/start_es.sh
</code></pre>
<hr>
<h2 id="ä¸ƒ-å¯åŠ¨é›†ç¾¤æ“ä½œæ­¥éª¤">ä¸ƒã€å¯åŠ¨é›†ç¾¤ï¼ˆæ“ä½œæ­¥éª¤ï¼‰</h2>
<h3 id="1-æ¸…ç©ºæ•°æ®ç›®å½•é¦–æ¬¡å¯åŠ¨">1. æ¸…ç©ºæ•°æ®ç›®å½•ï¼ˆé¦–æ¬¡å¯åŠ¨ï¼‰</h3>
<pre><code class="language-bash">rm -rf /data/elasticsearch/data/*
</code></pre>
<h3 id="2-å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶">2. å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒæ—¶ï¼‰</h3>
<pre><code class="language-bash">/root/start_es.sh start
</code></pre>
<hr>
<h2 id="å…«-éªŒè¯ä¸å±•ç¤ºæ­¥éª¤-æŸ¥çœ‹ç»“æœ">å…«ã€éªŒè¯ä¸å±•ç¤ºæ­¥éª¤ï¼ˆâœ… æŸ¥çœ‹ç»“æœï¼‰</h2>
<h3 id="1-æ£€æŸ¥çŠ¶æ€122-es2-è¾“å‡º">1. æ£€æŸ¥çŠ¶æ€ï¼ˆ<code>122-es2</code> è¾“å‡ºï¼‰</h3>
<pre><code class="language-bash">./start_es.sh status
</code></pre>
<h3 id="æ‰§è¡Œç»“æœ">âœ… æ‰§è¡Œç»“æœï¼š</h3>
<pre><code>ğŸ” æ­£åœ¨æ£€æŸ¥ Elasticsearch çŠ¶æ€...
ğŸŸ¡ æ£€æµ‹åˆ°å¤šä¸ª Elasticsearch è¿›ç¨‹ï¼ˆå¯èƒ½å­˜åœ¨æ®‹ç•™ï¼‰
   PID åˆ—è¡¨: 152116 152172
   ä¸» PID: 152116

ğŸ“¡ æ­£åœ¨è¿æ¥ REST API: http://localhost:9200
âœ… REST API å¯è®¿é—®

ğŸ“Š é›†ç¾¤å¥åº·çŠ¶æ€:
  | {
  |   &quot;cluster_name&quot; : &quot;elasticsearch&quot;,
  |   &quot;status&quot; : &quot;green&quot;,
  |   &quot;timed_out&quot; : false,
  |   &quot;number_of_nodes&quot; : 3,
  |   &quot;number_of_data_nodes&quot; : 3,
  |   &quot;active_primary_shards&quot; : 0,
  |   &quot;active_shards&quot; : 0,
  |   &quot;relocating_shards&quot; : 0,
  |   &quot;initializing_shards&quot; : 0,
  |   &quot;unassigned_shards&quot; : 0,
  |   &quot;delayed_unassigned_shards&quot; : 0,
  |   &quot;number_of_pending_tasks&quot; : 0,
  |   &quot;number_of_in_flight_fetch&quot; : 0,
  |   &quot;task_max_waiting_in_queue_millis&quot; : 0,
  |   &quot;active_shards_percent_as_number&quot; : 100.0
  | }

ğŸ” é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯:
  | ip           heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name
  | 172.31.7.123            8          98   1    0.98    0.28     0.11 cdfhilmrstw -      node-3
  | 172.31.7.122            8          98   2    0.75    0.31     0.15 cdfhilmrstw -      node-2
  | 172.31.7.121           17          97   1    0.56    0.22     0.15 cdfhilmrstw *      node-1

ğŸ“„ æœ€è¿‘æ—¥å¿— (/data/elasticsearch/logs/elasticsearch.log):
  |     at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:776)
  |     at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:26)
  |     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
  |     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
  |     at java.lang.Thread.run(Thread.java:833)
</code></pre>
<hr>
<h2 id="ä¹-ç»“æœåˆ†æ">ä¹ã€ç»“æœåˆ†æ</h2>
<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>ç»“è®º</th>
</tr>
</thead>
<tbody>
<tr>
<td>é›†ç¾¤åç§°</td>
<td><code>elasticsearch</code></td>
</tr>
<tr>
<td>èŠ‚ç‚¹æ•°</td>
<td>âœ… 3 ä¸ªèŠ‚ç‚¹æ­£å¸¸åŠ å…¥</td>
</tr>
<tr>
<td>é›†ç¾¤çŠ¶æ€</td>
<td>âœ… <code>green</code>ï¼ˆå¥åº·ï¼‰</td>
</tr>
<tr>
<td>ä¸»èŠ‚ç‚¹</td>
<td>âœ… <code>node-1</code>ï¼ˆ<code>*</code> æ ‡è®°ï¼‰</td>
</tr>
<tr>
<td>åˆ†ç‰‡åˆ†é…</td>
<td>âœ… <code>unassigned_shards: 0</code></td>
</tr>
<tr>
<td>è¿›ç¨‹çŠ¶æ€</td>
<td>âœ… å¤š PID ä¸º Java æ­£å¸¸çº¿ç¨‹</td>
</tr>
<tr>
<td>æ—¥å¿—</td>
<td>âœ… æ— é”™è¯¯ï¼Œçº¿ç¨‹è¿è¡Œæ­£å¸¸</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="å-ç»“è®º">åã€ç»“è®º</h2>
<ul>
<li>âœ… <strong>Elasticsearch 8.0.0 ä¸‰èŠ‚ç‚¹é›†ç¾¤å·²æˆåŠŸéƒ¨ç½²</strong></li>
<li>âœ… é›†ç¾¤çŠ¶æ€ä¸º <code>green</code>ï¼Œæ‰€æœ‰èŠ‚ç‚¹æ­£å¸¸é€šä¿¡</li>
<li>âœ… å¯åœè„šæœ¬åŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒæ—¥å¸¸è¿ç»´</li>
<li>âœ… å½“å‰ä¸ºç©ºé›†ç¾¤ï¼Œå¯å¼€å§‹å†™å…¥æ•°æ®</li>
</ul>
<hr>
<h2 id="åä¸€-åç»­å»ºè®®">åä¸€ã€åç»­å»ºè®®</h2>
<ol>
<li><strong>åˆ›å»ºæµ‹è¯•ç´¢å¼•</strong>ï¼ŒéªŒè¯å†™å…¥ä¸åˆ†ç‰‡åˆ†é…</li>
<li><strong>æ¨¡æ‹ŸèŠ‚ç‚¹å®•æœº</strong>ï¼Œæµ‹è¯•é«˜å¯ç”¨æ€§</li>
<li><strong>ç”Ÿäº§ç¯å¢ƒå¼€å¯å®‰å…¨åŠŸèƒ½</strong></li>
<li><strong>é…ç½® Kibana æˆ–ç›‘æ§ç³»ç»Ÿ</strong></li>
</ol>
<hr>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#elasticsearch-800-%E4%B8%89%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3">ğŸ“š Elasticsearch 8.0.0 ä¸‰èŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æ–‡æ¡£</a>
<ul>
<li><a href="#%E4%B8%80-%E6%93%8D%E4%BD%9C%E7%9B%AE%E6%A0%87">ä¸€ã€æ“ä½œç›®æ ‡</a></li>
<li><a href="#%E4%BA%8C-%E6%93%8D%E4%BD%9C%E7%8E%AF%E5%A2%83">äºŒã€æ“ä½œç¯å¢ƒ</a></li>
<li><a href="#%E4%B8%89-%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-%E4%BD%A0%E6%89%A7%E8%A1%8C%E7%9A%84%E5%8A%A8%E4%BD%9C">ä¸‰ã€æ“ä½œæ­¥éª¤ï¼ˆâœ… ä½ æ‰§è¡Œçš„åŠ¨ä½œï¼‰</a>
<ul>
<li><a href="#1-%E5%88%86%E5%8F%91%E8%BD%AF%E4%BB%B6%E5%8C%85%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9">1. åˆ†å‘è½¯ä»¶åŒ…ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</a></li>
<li><a href="#2-%E5%AE%89%E8%A3%85%E4%B8%8E%E7%9B%AE%E5%BD%95%E5%87%86%E5%A4%87%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9">2. å®‰è£…ä¸ç›®å½•å‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</a></li>
<li><a href="#3-%E5%88%9B%E5%BB%BA%E4%B8%93%E7%94%A8%E7%94%A8%E6%88%B7%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9">3. åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</a></li>
<li><a href="#4-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%97%A5%E5%BF%97%E7%9B%AE%E5%BD%95%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9">4. åˆ›å»ºæ•°æ®ä¸æ—¥å¿—ç›®å½•ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</a></li>
<li><a href="#5-%E9%85%8D%E7%BD%AE-elasticsearchyml%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9">5. é…ç½® <code>elasticsearch.yml</code>ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</a>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9%E7%A4%BA%E4%BE%8B121-es1">é…ç½®å†…å®¹ï¼ˆç¤ºä¾‹ï¼š<code>121-es1</code>ï¼‰</a></li>
</ul>
</li>
<li><a href="#6-%E8%B0%83%E6%95%B4%E7%B3%BB%E7%BB%9F%E5%8F%82%E6%95%B0%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9">6. è°ƒæ•´ç³»ç»Ÿå‚æ•°ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%86%99%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC">å››ã€ä¸ºä»€ä¹ˆè¦å†™å¯åŠ¨è„šæœ¬ï¼Ÿ</a>
<ul>
<li><a href="#%E9%97%AE%E9%A2%98">â“ é—®é¢˜</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E7%BC%96%E5%86%99-start_essh-%E8%84%9A%E6%9C%AC">âœ… è§£å†³æ–¹æ¡ˆï¼šç¼–å†™ <code>start_es.sh</code> è„šæœ¬</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E8%84%9A%E6%9C%AC%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF">äº”ã€è„šæœ¬è®¾è®¡æ€è·¯</a></li>
<li><a href="#%E5%85%AD-%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E5%86%85%E5%AE%B9rootstart_essh">å…­ã€å¯åŠ¨è„šæœ¬å†…å®¹ï¼ˆ<code>/root/start_es.sh</code>ï¼‰</a>
<ul>
<li><a href="#%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90">èµ‹äºˆæƒé™ï¼š</a></li>
</ul>
</li>
<li><a href="#%E4%B8%83-%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4">ä¸ƒã€å¯åŠ¨é›†ç¾¤ï¼ˆæ“ä½œæ­¥éª¤ï¼‰</a>
<ul>
<li><a href="#1-%E6%B8%85%E7%A9%BA%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95%E9%A6%96%E6%AC%A1%E5%90%AF%E5%8A%A8">1. æ¸…ç©ºæ•°æ®ç›®å½•ï¼ˆé¦–æ¬¡å¯åŠ¨ï¼‰</a></li>
<li><a href="#2-%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E5%90%8C%E6%97%B6">2. å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒæ—¶ï¼‰</a></li>
</ul>
</li>
<li><a href="#%E5%85%AB-%E9%AA%8C%E8%AF%81%E4%B8%8E%E5%B1%95%E7%A4%BA%E6%AD%A5%E9%AA%A4-%E6%9F%A5%E7%9C%8B%E7%BB%93%E6%9E%9C">å…«ã€éªŒè¯ä¸å±•ç¤ºæ­¥éª¤ï¼ˆâœ… æŸ¥çœ‹ç»“æœï¼‰</a>
<ul>
<li><a href="#1-%E6%A3%80%E6%9F%A5%E7%8A%B6%E6%80%81122-es2-%E8%BE%93%E5%87%BA">1. æ£€æŸ¥çŠ¶æ€ï¼ˆ<code>122-es2</code> è¾“å‡ºï¼‰</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C">âœ… æ‰§è¡Œç»“æœï¼š</a></li>
</ul>
</li>
<li><a href="#%E4%B9%9D-%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90">ä¹ã€ç»“æœåˆ†æ</a></li>
<li><a href="#%E5%8D%81-%E7%BB%93%E8%AE%BA">åã€ç»“è®º</a></li>
<li><a href="#%E5%8D%81%E4%B8%80-%E5%90%8E%E7%BB%AD%E5%BB%BA%E8%AE%AE">åä¸€ã€åç»­å»ºè®®</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://orochw.github.io/post/prometheus-shi-yong-yuan-duan-cun-chu-victoriametrics-ji-qun/">
              <h3 class="post-title">
                Prometheusä½¿ç”¨è¿œç«¯å­˜å‚¨VictoriaMetricsé›†ç¾¤
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'e16544ded74efb82c5cb',
    clientSecret: 'cc815ef9f98d5cf6d79ae6f9ca0f9fc2b521645a',
    repo: 'Gitalk',
    owner: 'OrochW',
    admin: ['OrochW'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://orochw.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
